library(dplyr)
library(dplyr)
library(dplyr)
install.packages("dplyr")
library(dplyr)
# Import the relevant libraries
suppressWarnings(library(plyr))
suppressWarnings(library(tseries))
suppressWarnings(library(forecast))
suppressWarnings(library(lmtest))
suppressWarnings(library(car))
library(dplyr)
# Import the relevant libraries
suppressWarnings(library(plyr))
suppressWarnings(library(tseries))
suppressWarnings(library(forecast))
suppressWarnings(library(lmtest))
#suppressWarnings(library(car))
suppressWarnings(library(arfima))
library(dplyr)
# Import the relevant libraries
#suppressWarnings(library(plyr))
suppressWarnings(library(tseries))
suppressWarnings(library(forecast))
suppressWarnings(library(lmtest))
#suppressWarnings(library(car))
#suppressWarnings(library(arfima))
#suppressWarnings(library(tsibble))
suppressWarnings(library(ggplot2))
suppressWarnings(library(gridExtra))
#suppressWarnings(library(zoo))
nyctaxi.data <- read.csv("./nyc_taxi.csv")
head(nyctaxi.data)
tail(nyctaxi.data)
dim(nyctaxi.data)
nyctaxi.data$timestamp_dt <- as.POSIXct(nyctaxi.data$timestamp)
#nyctaxi.data$value_boxcox <- BoxCox(nyctaxi.data$value, lambda = 3.5)
#head(nyctaxi.data)
plot1 <- ggplot(nyctaxi.data, aes(x = value)) + geom_histogram() + theme_light()
plot2 <- ggplot(nyctaxi.data, aes(sample = value)) +  geom_line(mapping=aes(x=timestamp_dt, y=value)) + theme_light()
grid.arrange(plot1, plot2, nrow=3)
acf(nyctaxi.data$value)
subsamp <- nyctaxi.data[nyctaxi.data$timestamp_dt < as.POSIXct("2014-07-08 00:00:00"),]
plot1 <- ggplot(subsamp, aes(x = value)) + geom_histogram() + theme_light()
plot2 <- ggplot(subsamp, aes(sample = value)) +  geom_line(mapping=aes(x=timestamp_dt, y=value)) + theme_light()
grid.arrange(plot1, plot2, nrow=2)
anomaly_points <- as.POSIXct(c(
"2014-11-01 19:00:00",
"2014-11-27 15:30:00",
"2014-12-25 15:00:00",
"2015-01-01 01:00:00",
"2015-01-27 00:00:00"
))
nyctaxi.data$flag_anomaly <- ifelse(nyctaxi.data$timestamp_dt %in% anomaly_points, TRUE, FALSE)
nyctaxi.data %>% filter(timestamp_dt %in% anomaly_points)
#ggsave(filename="taxi_anomalies.pdf", w=20, h=5, dpi=500)
ggplot() +
geom_line(mapping=aes(x=timestamp_dt, y=value), data=nyctaxi.data) +
geom_vline(xintercept=as.numeric(anomaly_points), linetype="dotted", color="red", size=1) +
theme_light()
# Recheck for stationarity
kpss.test(nyctaxi.data$value)
adf.test(nyctaxi.data$value, alternative="stationary", k=10)
pp.test(nyctaxi.data$value)
ma.order <- 24*2*7
trend_nyc = ma(nyctaxi.data$value, order = ma.order, centre = T)
ggplot() +
geom_line(mapping=aes(x=timestamp_dt, y=value), color="black", data=nyctaxi.data) +
geom_line(mapping=aes(x=nyctaxi.data$timestamp_dt, y=trend_nyc), color="red")
nyc_ma = ts(na.omit(nyctaxi.data$value),
frequency=ma.order)
decomp = stl(nyc_ma, s.window="periodic")
nyctaxi.data$value_deseas <- seasadj(decomp)
plot(decomp)
acf(nyctaxi.data$value_deseas)
ggsave(filename="taxi_anomalies_2.pdf", w=20, h=5, dpi=500)
ggplot() +
#geom_line(mapping=aes(x=timestamp_dt, y=value_deseas), color="black", data=nyctaxi.data) +
geom_line(mapping=aes(x=timestamp_dt, y=value), color="black", alpha=1, data=nyctaxi.data) +
geom_vline(xintercept=as.numeric(anomaly_points), linetype="dotted", color="red", size=1) +
theme_light()
kpss.test(nyctaxi.data$value_deseas)
adf.test(nyctaxi.data$value_deseas, alternative="stationary", k=10)
pp.test(nyctaxi.data$value)
library(dplyr)
# Import the relevant libraries
#suppressWarnings(library(plyr))
suppressWarnings(library(tseries))
suppressWarnings(library(forecast))
suppressWarnings(library(lmtest))
#suppressWarnings(library(car))
#suppressWarnings(library(arfima))
#suppressWarnings(library(tsibble))
suppressWarnings(library(ggplot2))
suppressWarnings(library(gridExtra))
#suppressWarnings(library(zoo))
nyctaxi.data <- read.csv("./nyc_taxi.csv")
head(nyctaxi.data)
tail(nyctaxi.data)
dim(nyctaxi.data)
nyctaxi.data$timestamp_dt <- as.POSIXct(nyctaxi.data$timestamp)
#nyctaxi.data$value_boxcox <- BoxCox(nyctaxi.data$value, lambda = 3.5)
#head(nyctaxi.data)
plot1 <- ggplot(nyctaxi.data, aes(x = value)) + geom_histogram() + theme_light()
plot2 <- ggplot(nyctaxi.data, aes(sample = value)) +  geom_line(mapping=aes(x=timestamp_dt, y=value)) + theme_light()
grid.arrange(plot1, plot2, nrow=3)
acf(nyctaxi.data$value)
subsamp <- nyctaxi.data[nyctaxi.data$timestamp_dt < as.POSIXct("2014-07-08 00:00:00"),]
plot1 <- ggplot(subsamp, aes(x = value)) + geom_histogram() + theme_light()
plot2 <- ggplot(subsamp, aes(sample = value)) +  geom_line(mapping=aes(x=timestamp_dt, y=value)) + theme_light()
grid.arrange(plot1, plot2, nrow=2)
anomaly_points <- as.POSIXct(c(
"2014-11-01 19:00:00",
"2014-11-27 15:30:00",
"2014-12-25 15:00:00",
"2015-01-01 01:00:00",
"2015-01-27 00:00:00"
))
nyctaxi.data$flag_anomaly <- ifelse(nyctaxi.data$timestamp_dt %in% anomaly_points, TRUE, FALSE)
nyctaxi.data %>% filter(timestamp_dt %in% anomaly_points)
#ggsave(filename="taxi_anomalies.pdf", w=20, h=5, dpi=500)
ggplot() +
geom_line(mapping=aes(x=timestamp_dt, y=value), data=nyctaxi.data) +
geom_vline(xintercept=as.numeric(anomaly_points), linetype="dotted", color="red", size=1) +
theme_light()
# Recheck for stationarity
kpss.test(nyctaxi.data$value)
adf.test(nyctaxi.data$value, alternative="stationary", k=10)
pp.test(nyctaxi.data$value)
ma.order <- 24*2*7
trend_nyc = ma(nyctaxi.data$value, order = ma.order, centre = T)
ggplot() +
geom_line(mapping=aes(x=timestamp_dt, y=value), color="black", data=nyctaxi.data) +
geom_line(mapping=aes(x=nyctaxi.data$timestamp_dt, y=trend_nyc), color="red")
nyc_ma = ts(na.omit(nyctaxi.data$value),
frequency=ma.order)
decomp = stl(nyc_ma, s.window="periodic")
nyctaxi.data$value_deseas <- seasadj(decomp)
plot(decomp)
acf(nyctaxi.data$value_deseas)
ggsave(filename="taxi_anomalies_2.pdf", w=20, h=5, dpi=500)
ggplot() +
#geom_line(mapping=aes(x=timestamp_dt, y=value_deseas), color="black", data=nyctaxi.data) +
geom_line(mapping=aes(x=timestamp_dt, y=value), color="black", alpha=1, data=nyctaxi.data) +
geom_vline(xintercept=as.numeric(anomaly_points), linetype="dotted", color="red", size=1) +
theme_light()
kpss.test(nyctaxi.data$value_deseas)
adf.test(nyctaxi.data$value_deseas, alternative="stationary", k=10)
pp.test(nyctaxi.data$value)
ggsave(filename="taxi_anomalies_2.pdf", w=20, h=5, dpi=500)
ggplot() +
#geom_line(mapping=aes(x=timestamp_dt, y=value_deseas), color="black", data=nyctaxi.data) +
geom_line(mapping=aes(x=timestamp_dt, y=value), color="black", alpha=1, data=nyctaxi.data) +
geom_vline(xintercept=as.numeric(anomaly_points), linetype="dotted", color="red", size=1) +
theme_light()
